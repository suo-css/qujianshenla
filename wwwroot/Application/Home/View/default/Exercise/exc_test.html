    <extend name="Base/common"/>

    <block name="body">
        <div class="panel">
            <div class="row">
                <div class="span4">
                    <span class="b">我的状态</span><br>
                    <div style="line-height: 32px;">
                        当前体重  <span style="font-size: 32px;line-height: 32px;">70</span> kg<br>
                        当前体脂  <span style="font-size: 32px;line-height: 32px;">35</span> %
                    </div>
                </div>
                <div class="span4">
                    <div  style="position: absolute;top: 3px;right: 3px;">
                        选择具体:
                        <select>
                            <option>体重体脂</option>
                            <option>维度</option>
                            <option>力量</option>
                        </select>
                        <select>
                            <option>体重</option>
                            <option>体脂</option>
                        </select>
                    </div>
                    <div class="h200" id="charts">

                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="span5">
                <div class="panel h300">
                    <span class="b">体重</span>
                    <div style="margin-top:20px">
                        <div class="floatL b">起始时间:2012-6-8</div>
                        <div class="floatR b">结束时间:2015-3-4</div>
                        <div class="clearfix"></div>
                        <div class="myProgress">
                            <div class="myProgress-weight-start">35</div>
                            <div class="myProgress-pgs">
                                <div class="myProgress-weight-done" style="width:50%"></div>
                            </div>
                            <div class="myProgress-goal">46</div>
                        </div>
                        <div style="mgTop5 todayFrame">
                            今天的体重 :
                            <input type="text" style="width:150px">&nbsp;<button class="btn" style="margin-top:-10px">提 交</button>
                        </div>
                    </div>
                    <span class="b">体脂</span>
                    <div class="mgTop20">
                        <div class="floatL b">起始时间:2012-6-8</div>
                        <div class="floatR b">结束时间:2015-3-4</div>
                        <div class="clearfix"></div>
                        <div class="myProgress">
                            <div class="myProgress-weight-start">35</div>
                            <div class="myProgress-pgs">
                                <div class="myProgress-weight-done" style="width:50%"></div>
                            </div>
                            <div class="myProgress-goal">46</div>
                        </div>
                        <div class="mgTop5 todayFrame" >
                            今天的体重 :
                            <input type="text" style="width:150px">&nbsp;<button class="btn" style="margin-top:-10px">提 交</button>
                        </div>
                    </div>
                </div>


                <div class="panel h300">
                    <span class="b">力量</span>
                    <br>
                    <volist name='list' id="vo">
                        <if condition="goal_type($vo['id']) neq 0"> 
                            <span class="b">{$vo.typename}</span> <a href="javascript:;" id="{$vo.id}" name="{$vo.typename}" onclick="goaledit(this)"  type="edit">编辑</a>
                            <div style="margin-top:20px">
                                <input type="hidden" name="" value="<?php goal_types($vo['id'],'id') ?>" id="id_{$vo.id}">
                                <div class="floatL b">起始时间:
                                    <span id="start_{$vo.id}"><?php goal_types($vo['id'],'startdate') ?></span>
                                </div>
                                <div class="floatR b">结束时间:
                                    <span id="end_{$vo.id}"><?php goal_types($vo['id'],'goaldate') ?></span>
                                </div>     
                                <div class="clearfix"></div>
                                <div class="myProgress">
                                    <div class="myProgress-strength-start">
                                        <span id="start_value_{$vo.id}"><?php goal_types($vo['id'],'startvalue') ?></span>
                                    </div>
                                    <div class="myProgress-pgs">
                                    <div class="myProgress-strength-done" id="length_{$vo.id}" style="width:<?php echo goal_types($vo['id'],'currentvalue') ?>%">  
                                    </div>
                                    </div>

                                    <if condition="goal_types($vo['id'],'currentvalue') lt 100">
                                      <div  class="myProgress-strength-cur" id="class_{$vo.id}-strength">
                                    <else />
                                      <div  class="myProgress-strength-end" id="class_{$vo.id}-strength">
                                    </if>

                                    <span id="end_value_{$vo.id}"><?php goal_types($vo['id'],'goalvalue') ?></span>
                                    </div>
                                </div>
                               <div class="mgTop5 todayFrame" >
                                    今天的{$vo.typename} :
                                    <input type="text" value="" id="current-<?php goal_types($vo['id'],'id') ?>" style="width:150px">&nbsp;<button class="btn" style="margin-top:-10px" onclick="current(<?php goal_types($vo['id'],'id') ?>,{$vo.id},'strength')">提 交</button>
                                    <span style="display:none;" id="current-error-<?php goal_types($vo['id'],'id') ?>"></span>
                                </div>
                            </div>
                         <else />
                            <span class="b">{$vo.typename}</span> <a href="javascript:;" id="{$vo.id}" name="{$vo.typename}" onclick="goaledit(this)" type="add">编辑</a>

                            <span id="{$vo.id}_class_add" style="display:none;">strength</span>

                            <div style="margin-top:20px">
                                <input type="hidden" name="" value="" id="id_{$vo.id}">
                                <div class="floatL b">起始时间:<span id="start_{$vo.id}"></span></div>
                                <div class="floatR b">结束时间:<span id="end_{$vo.id}"></span></div>
                                <div class="clearfix"></div>
                                <div class="myProgress">
                                    <div class="myProgress-strength-start"><span id="start_value_{$vo.id}">0</span></div>
                                    <div class="myProgress-pgs">
                                        <div class="myProgress-strength-done" id="length_{$vo.id}" style="width:0%"></div>
                                    </div>
                                    <div class="myProgress-goal"><span id="end_value_{$vo.id}">0</span></div>
                                </div>
                            </div>
                         </if>
                    </volist>    
                </div>
            </div>




            <div class="span4">
                <div class="panel h670">
                    <span class="b">维度</span>
                     <br>
                    <volist name='list1' id="vo">
                        <if condition="goal_type($vo['id']) neq 0"> 
                            <span class="b">{$vo.typename}</span> <a href="javascript:;" id="{$vo.id}" name="{$vo.typename}" onclick="goaledit(this)"  type="edit">编辑</a>
                            <div style="margin-top:20px">
                                <input type="hidden" name="" value="<?php goal_types($vo['id'],'id') ?>" id="id_{$vo.id}">
                                <div class="floatL b">起始时间:
                                    <span id="start_{$vo.id}"><?php goal_types($vo['id'],'startdate') ?></span>
                                </div>
                                <div class="floatR b">结束时间:
                                    <span id="end_{$vo.id}"><?php goal_types($vo['id'],'goaldate') ?></span>
                                </div>   

                                <div class="clearfix"></div>
                                <div class="myProgress">
                                    <div class="myProgress-dimension-start">
                                        <span id="start_value_{$vo.id}"><?php goal_types($vo['id'],'startvalue') ?></span>
                                    </div>
                                    <div class="myProgress-pgs">
                                    <div class="myProgress-dimension-done" id="length_{$vo.id}" style="width:<?php echo goal_types($vo['id'],'currentvalue') ?>%">  
                                    </div>
                                    </div>
                                    <if condition="goal_types($vo['id'],'currentvalue') lt 100">
                                      <div class="myProgress-goal" id="class_{$vo.id}-dimension" >
                                    <else />
                                      <div class="myProgress-dimension-end" id="class_{$vo.id}-dimension" >
                                    </if>

                                    

                                    <span id="end_value_{$vo.id}"><?php goal_types($vo['id'],'goalvalue') ?></span>
                                    </div>
                                </div>
                               <div class="mgTop5 todayFrame" >
                                    今天的{$vo.typename} :
                                    <input type="text" value="" id="current-<?php goal_types($vo['id'],'id') ?>" style="width:150px">&nbsp;<button class="btn" style="margin-top:-10px" onclick="current(<?php goal_types($vo['id'],'id','dimension') ?>,{$vo.id},'dimension')">提 交</button>
                                    <span style="display:none;" id="current-error-<?php goal_types($vo['id'],'id') ?>"></span>
                                </div>
                            </div>
                         <else />
                            <span class="b">{$vo.typename}</span> <a href="javascript:;" id="{$vo.id}" name="{$vo.typename}" onclick="goaledit(this)" type="add">编辑</a>

                            <span id="{$vo.id}_class_add" style="display:none;">dimension</span>

                            <div style="margin-top:20px">
                                <input type="hidden" name="" value="" id="id_{$vo.id}">
                                <div class="floatL b">起始时间:<span id="start_{$vo.id}"></span></div>
                                <div class="floatR b">结束时间:<span id="end_{$vo.id}"></span></div>
                                <div class="clearfix"></div>
                                <div class="myProgress">
                                    <div class="myProgress-dimension-start"><span id="start_value_{$vo.id}">0</span></div>
                                    <div class="myProgress-pgs">
                                        <div class="myProgress-strength-done" id="length_{$vo.id}" style="width:0%"></div>
                                    </div>
                                    <div class="myProgress-goal"><span id="end_value_{$vo.id}">0</span></div>
                                </div>
                            </div>
                            <div class="mgTop5 todayFrame" style="display:none;" id="current_save_{$vo.id}">
                                    今天的{$vo.typename} :
                                    <span>

                                    </span> 
                            </div>
                         </if>
                    </volist>  
                </div>
            </div>
        </div>

         <!--弹出-->
        <!-- Modal -->
        <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h3 id="create_goal"></h3>

          </div>
          <div class="modal-body">
                <input type="hidden" id="detailtypeid" value=""> 
                <input type="hidden" id="type" value="">
                <input type="hidden" id="save_id" value="">
                开始值：<input type="text" name="" id="startvalue" ><br>
                目标值：<input type="text" name="" id="goalvalue" ><br>
                目标时间：<input type="text" onkeyup="this.value=''" id="goaldate">
                <br>
                <span style="color:red;display:none;" id="save_error"></span>
          </div>
          <div class="modal-footer">
            <button class="btn" data-dismiss="modal" id="create_hide"  aria-hidden="true">关闭</button>
            <button class="btn btn-primary" id="save">保存</button>
          </div>
        </div>


        <div class="panel">
            sadf
        </div>

        <link href="__STATIC__/datetimepicker/css/datetimepicker.css" rel="stylesheet" type="text/css">
        <php>if(C('COLOR_STYLE')=='blue_color') echo '<link href="__STATIC__/datetimepicker/css/datetimepicker_blue.css" rel="stylesheet" type="text/css">';</php>
        <link href="__STATIC__/datetimepicker/css/dropdown.css" rel="stylesheet" type="text/css">
        <script type="text/javascript" src="__STATIC__/datetimepicker/js/bootstrap-datetimepicker.min.js"></script>
        <script type="text/javascript" src="__STATIC__/datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script>
        <script type="text/javascript">
            $(function () {
                //$('#myModal').modal();
                function initProgress(){
                    var $pgs = $(".myProgress-pgs");
                    $pgs.each(function(){
                        var $ts = $(this)
                        var $prt = $(this).parent();
                        $ts.width($prt.width()-58);
                    });
                    
                }
                initProgress();
                $(window).resize(initProgress);
                $('#charts').highcharts({
                    exporting: {
                        url:"http://export.hcharts.cn"
                    },
                    title: {
                        text: 'Monthly Average Temperature',
                        x: -20 //center
                    },
                    xAxis: {
                        categories: ['一', '五', '十', '十五', '二十', '二六','七', '八', '九', '十', '十一', '十二','十三']
                        //设置横坐标
                    },
                    yAxis: {
                        title: {
                            text: '重量(Kg)'//设置纵坐标单位
                        },
                        plotLines: [{
                            value: 0,
                            width: 1,
                            color: '#808080'
                        }]
                    },
                    tooltip: {
                        valueSuffix: '°C'
                    },
                    legend: {
                        layout: 'vertical',
                        align: 'right',
                        verticalAlign: 'middle',
                        borderWidth: 0
                    },
                    series: [{
                        name: '东京',
                        data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6,9.5]
                    }]
                });
                   
                //新建目标
                $("#save").click(function(){
                    startvalue = $.trim($("#startvalue").val());
                    goalvalue = $.trim($("#goalvalue").val());
                    goaldate = $.trim($("#goaldate").val());
                    detailtypeid = $.trim($("#detailtypeid").val());
                    type = $.trim($("#type").val());
                    time = "<?php echo date('Y-m-d') ?>";
                    starttime = "<?php echo time();?>";
                    save_id = $("#save_id").val();
                    if(startvalue==null || startvalue==""){
                        $("#save_error").show().text("开始值不能为空！");
                        $("#startvalue").focus();
                        return;
                    }

                    if(goalvalue==null || goalvalue==""){
                        $("#save_error").show().text("目标值不能为空！");
                        $("#goalvalue").focus();
                        return;
                    }

                    if(startvalue<goalvalue){
                        alert(startvalue);
                        alert(goalvalue);
                        alert('1');
                        $("#save_error").show().text("开始值不能小于或等于目标值!");
                        $("#startvalue").focus();
                        return;
                    }
                    return 
                    if (isNaN(startvalue)) {
                        $("#save_error").show().text("开始值须为数字！");
                        $("#startvalue").focus();
                        return;
                    };
                    if (isNaN(goalvalue)) {
                        $("#save_error").show().text("目标值须为数字！");
                        $("#goalvalue").focus();
                        return;
                    };
                    if(goaldate==null || goaldate==""){
                        $("#save_error").show().text("目标时间不能为空！");
                        $("#goaldate").focus();
                        return;
                    }
                    $("#save_error").hide();
                    str = goaldate.replace(/-/g,'/'); 
                    var date = new Date(str); 
                    var endtime = date.getTime() / 1000;
                    if(endtime<starttime){
                        $("#save_error").show().text("目标时间不能小于当前日期！");
                        $("#goaldate").focus();
                        return;
                    }
                    var posturl = "{:U('Exercise/goal')}";
                    var info = {
                        startvalue:startvalue,
                        goalvalue:goalvalue,
                        goaldate:goaldate,
                        detailtypeid:detailtypeid,
                        type:type,
                        save_id:save_id
                    };
                    return
                    $.post(posturl,info,function(data){
                        if(data.errno==1){
                            $("#create_hide").click();
                            $("#start_"+detailtypeid).html(time);
                            $("#end_"+detailtypeid).html(goaldate);
                            $("#start_value_"+detailtypeid).text(startvalue);
                            $("#end_value_"+detailtypeid).text(goalvalue);
                            $("#startvalue").val("");
                            $("#goalvalue").val("");
                            $("#goaldate").val("");
                            $("#"+detailtypeid).attr("type","edit");
                            if(data.id){
                                $("#id_"+detailtypeid).val(data.id);
                                $("#current_save_"+detailtypeid).show();
                                var class_add = $("#"+detailtypeid+"_class_add").text();;
                                $("#current_save_"+detailtypeid+" span").html("<input type=text id=current-"+data.id+" style=width:150px><button onclick=current("+data.id+","+detailtypeid+",'"+class_add+"') class=btn style=margin-top:-10px>提 交</button><span style=display:none; id=current-error-"+data.id+" ></span>");
                                        }
                        }else{
                            alert(data.msg);
                        }
                    },'json');
                }); 
                $('#goaldate').datetimepicker({
                    format: 'yyyy-mm-dd',
                    language:"zh-CN",
                    minView:2,
                    autoclose:true
                });
            });

            //添加新的goal,id 动作ID,name 动作名称
            function goaledit(obj){
                $("#create_goal").text(obj.name);
                $("#detailtypeid").val(obj.id);
                
                type = $(obj).attr('type');
                if(type=='edit'){
                    $("#startvalue").val($("#start_value_"+obj.id).text());
                    $("#startvalue").attr('disabled',true);
                    $("#goalvalue").val($("#end_value_"+obj.id).text());
                    $("#goaldate").val($("#end_"+obj.id).text());
                    $("#save_id").val($("#id_"+obj.id).val());
                }else{
                    $("#startvalue").attr('disabled',false);
                    $("#startvalue").val("");
                    $("#goalvalue").val("");
                    $("#goaldate").val("");
                }
                $("#type").val(type);
                $('#myModal').modal();
            }

            function current(id,tid,clas){
                var current  =  Number(parseInt($.trim($("#current-"+id).val())));//当前值

                var start    = $("#start_value_"+tid).text()//起始值

                var end      = $("#end_value_"+tid).text()//目标值

                var url      = "{:U('Exercise/current')}"

                var strclass =  "myProgress-"+clas+"-cur";

                var endclass =  "myProgress-"+clas+"-end";

                if(current!="" && current!=null){
                    $.post(url,{id:id,current:current},function(data){
                        if(data){
                            //如果更新值大于目标值
                            if(current>=end){
                                $("#length_"+tid).animate({width:'100%'},function(){
                                    $("#class_"+tid+"-"+clas).removeClass(strclass);
                                    $("#class_"+tid+"-"+clas).removeClass("myProgress-goal");
                                    $("#class_"+tid+"-"+clas).addClass(endclass);
                                });
                            }

                            //如果更新值大于起始值，小于目标值
                            if(current>start && current<end && current!=end){
                                var len = (current-start)/(end-start)*100+"%";
                                $("#length_"+tid).animate({width:len});
                                $("#class_"+tid+"-"+clas).removeClass(endclass);
                                $("#class_"+tid+"-"+clas).addClass("myProgress-goal");
                            }
                            //如果更新值小于或者等于起始值
                            if(current==start || current<start){
                                 $("#length_"+tid).animate({width:'0%'});
                            }

                            $("#current-error-"+id).show().text('更新成功！');
                        }
                    })
                }
            }
        </script>
</block>

  